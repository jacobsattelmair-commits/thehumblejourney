<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Photos — The Humble Journey</title>
  <meta name="description" content="Photos by Jacob Sattelmair.">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="nav">
    <div class="nav__inner">
      <a href="index.html" class="nav__name">The Humble Journey</a>
      <button class="nav__toggle" id="navToggle" aria-expanded="false" aria-label="Toggle menu">
        <span></span><span></span><span></span>
      </button>
      <ul class="nav__links" id="navLinks">
        <li><a href="index.html">Home</a></li>
        <li><a href="thoughts.html">Thoughts</a></li>
        <li><a href="bio.html">Bio</a></li>
        <li><a href="photos.html" class="active">Photos</a></li>
      </ul>
    </div>
  </nav>

  <main>
    <section class="page-header">
      <div class="container">
        <span class="label">Gallery</span>
        <h1>Photos</h1>
        <p class="page-intro">A few things worth seeing.</p>
      </div>
    </section>

    <section class="photos-section">
      <div class="container">
        <div class="photo-grid" id="photoGrid">
          <div class="posts__empty" id="loadingMsg"><p>Loading photos…</p></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" style="display:none;" role="dialog" aria-modal="true">
    <button id="lightboxClose" aria-label="Close">&times;</button>
    <button id="lightboxPrev" aria-label="Previous">&#8249;</button>
    <div id="lightboxInner">
      <img id="lightboxImg" src="" alt="">
      <p id="lightboxCaption"></p>
    </div>
    <button id="lightboxNext" aria-label="Next">&#8250;</button>
  </div>

  <footer>
    <div class="container">
      <p>&copy; 2025 Jacob Sattelmair &mdash; thehumblejourney.com</p>
    </div>
  </footer>

  <script src="main.js"></script>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", function(user) {
        if (!user) {
          window.netlifyIdentity.on("login", function() {
            document.location.href = "/admin/";
          });
        }
      });
    }

    const REPO = 'jacobsattelmair-commits/thehumblejourney';
    const PHOTOS_API = 'https://api.github.com/repos/' + REPO + '/contents/thehumblejourney-site/photos';
    const RAW_BASE = 'https://raw.githubusercontent.com/' + REPO + '/main/thehumblejourney-site/photos/';
    const IMAGE_EXTS = /\.(jpg|jpeg|png|gif|webp|avif)$/i;

    let photoUrls = [];
    let currentIndex = 0;

    async function loadPhotos() {
      const grid = document.getElementById('photoGrid');
      try {
        const res = await fetch(PHOTOS_API);
        if (!res.ok) throw new Error('Could not fetch photos');
        const files = await res.json();
        const images = files.filter(f => IMAGE_EXTS.test(f.name));
        if (images.length === 0) {
          grid.innerHTML = '<div class="posts__empty"><p>No photos yet.</p></div>';
          return;
        }
        photoUrls = images.map(f => RAW_BASE + encodeURIComponent(f.name));
        const captions = images.map(f => f.name.replace(/\.[^.]+$/, '').replace(/[-_]/g, ' '));
        window._photoCaptions = captions;
        grid.innerHTML = images.map((f, i) => `
          <div class="photo-item">
            <img src="${RAW_BASE + encodeURIComponent(f.name)}"
                 alt="${captions[i]}"
                 loading="lazy"
                 data-index="${i}">
            <span class="photo-caption">${captions[i]}</span>
          </div>
        `).join('');
        grid.querySelectorAll('img').forEach(img => {
          img.addEventListener('click', () => openLightbox(parseInt(img.dataset.index)));
        });
      } catch (err) {
        grid.innerHTML = '<div class="posts__empty"><p>Could not load photos right now.</p></div>';
        console.error(err);
      }
    }

    function openLightbox(index) {
      currentIndex = index;
      document.getElementById('lightboxImg').src = photoUrls[currentIndex];
      document.getElementById('lightboxCaption').textContent = (window._photoCaptions || [])[currentIndex] || '';
      document.getElementById('lightbox').style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      document.getElementById('lightbox').style.display = 'none';
      document.body.style.overflow = '';
    }

    document.getElementById('lightboxClose').addEventListener('click', closeLightbox);
    document.getElementById('lightboxPrev').addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + photoUrls.length) % photoUrls.length;
      document.getElementById('lightboxImg').src = photoUrls[currentIndex];
      document.getElementById('lightboxCaption').textContent = (window._photoCaptions || [])[currentIndex] || '';
    });
    document.getElementById('lightboxNext').addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % photoUrls.length;
      document.getElementById('lightboxImg').src = photoUrls[currentIndex];
      document.getElementById('lightboxCaption').textContent = (window._photoCaptions || [])[currentIndex] || '';
    });
    document.getElementById('lightbox').addEventListener('click', function(e) {
      if (e.target === this) closeLightbox();
    });
    document.addEventListener('keydown', e => {
      if (document.getElementById('lightbox').style.display === 'none') return;
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowLeft') document.getElementById('lightboxPrev').click();
      if (e.key === 'ArrowRight') document.getElementById('lightboxNext').click();
    });

    loadPhotos();
  </script>
</body>
</html>
